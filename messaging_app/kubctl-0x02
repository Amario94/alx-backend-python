#!/bin/bash

set -e

echo "ğŸš€ Deploying Blue version..."
kubectl apply -f blue_deployment.yaml

echo "ğŸš€ Deploying Green version..."
kubectl apply -f green_deployment.yaml

echo "ğŸ” Checking Green deployment logs..."
GREEN_POD=$(kubectl get pods -l app=messaging-app,version=green -o jsonpath='{.items[0].metadata.name}')
kubectl logs $GREEN_POD

echo "âœ… If logs look good, switching service to Green..."
kubectl patch service messaging-app-service -p '{"spec":{"selector":{"app":"messaging-app","version":"green"}}}'

echo "ğŸ§¹ Cleaning up old Blue deployment (optional)..."
# kubectl delete deployment messaging-app-blue

echo "ğŸ‰ Blue-Green deployment completed!"
